# QUICK START - Get Migration Working in 3 Steps

## Overview

This migration system **actually works**. It will:
1. Install Node.js, PostgreSQL, Redis, Git, and build tools on target server
2. Alert you when installation is complete
3. Migrate all your data
4. Switch to the new server

---

## Step 1: Copy Files (2 minutes)

```bash
# Copy these 4 files to your project:
cp migration-installer.ts server/services/
cp migration-orchestrator.ts server/services/
cp migration-enhanced-routes.ts server/routes/
cp MigrationWizard-Enhanced.tsx src/components/
```

---

## Step 2: Register Route (1 minute)

In `server/index.ts` (or wherever you create your Express app):

```typescript
import migrationRoutes from './routes/migration-enhanced-routes';

// Add this middleware (attach database pool to request)
app.use((req, res, next) => {
  (req as any).dbPool = pool; // Your existing database pool
  next();
});

// Add this route
app.use('/api/migration', migrationRoutes);
```

---

## Step 3: Add UI (1 minute)

In your admin panel (wherever you want the migration wizard):

```typescript
import { MigrationWizard } from '../components/MigrationWizard-Enhanced';

// In your component:
<MigrationWizard userId={currentUser.id} />
```

---

## That's It!

Now when you open the Migration Wizard:

1. Click **"Check Server"** → Shows what's missing
2. Click **"Install Prerequisites"** → Installs everything automatically
3. Wait for **"✅ Target Server Ready"** alert
4. Click **"Start Migration"** → Migrates all data with progress bars
5. Click **"Perform Cutover"** → Switches to new server

---

## What Happens Behind the Scenes

### When User Clicks "Install Prerequisites"

```
1. Creates /opt/neurocore directories
2. Downloads and installs Node.js 20 LTS
3. Downloads and installs PostgreSQL 16
4. Starts PostgreSQL service
5. Downloads and installs Redis
6. Starts Redis service
7. Installs Git
8. Installs C++ build tools
9. Creates database "neurocore_prod"
10. Creates database user with secure password
11. Alerts: "✅ Target Server Ready"
```

### When User Clicks "Start Migration"

```
1. Runs all .sql migration files
2. Creates all tables with indexes
3. Migrates data:
   - users
   - conversations
   - messages
   - unified_memory
   - domain_entanglements
   - blueprints
   - (all tables, in batches of 1000)
4. Shows progress bar for each table
5. Verifies record counts match
6. Alerts: "Ready for Cutover"
```

### When User Clicks "Perform Cutover"

```
1. Suspends old server
2. Marks new server as primary
3. Logs audit event
4. Alerts: "✅ Migration Complete!"
```

---

## Example Timeline

```
00:00 - User opens Migration Wizard
00:01 - Clicks "Check Server"
00:02 - Sees "Missing: Node.js, PostgreSQL, Redis"
00:03 - Clicks "Install Prerequisites"
00:05 - Node.js installing... ✓
00:07 - PostgreSQL installing... ✓
00:08 - PostgreSQL service starting... ✓
00:09 - Redis installing... ✓
00:10 - Redis service starting... ✓
00:11 - Git installing... ✓
00:12 - Build tools installing... ✓
00:13 - Creating database... ✓
00:14 - Alert: "✅ Target Server Ready"
00:15 - User clicks "Start Migration"
00:16 - Running migrations... ✓
00:17 - Migrating users (1,234 → 1,234) ✓
00:18 - Migrating conversations (5,678 → 5,678) ✓
00:20 - Migrating messages (12,345 → 12,345) ✓
00:25 - All tables migrated ✓
00:26 - Alert: "Ready for Cutover"
00:27 - User confirms cutover
00:28 - Suspending old server... ✓
00:29 - Alert: "✅ Migration Complete!"
00:30 - User clicks "Refresh"
00:31 - Now running on new server!
```

**Total Time: ~30 minutes** (depending on data size and internet speed)

---

## Key Features

✅ **Automatic Installation** - No manual setup
✅ **Live Progress** - See exactly what's happening
✅ **Error Handling** - Clear error messages
✅ **Verification** - Checks everything before proceeding
✅ **Rollback Safe** - Old server suspended, not deleted
✅ **Platform Support** - Windows, Linux, macOS

---

## Dependencies

Only one additional npm package needed:

```bash
npm install archiver
```

Everything else is handled automatically!

---

## What You See in the UI

### Phase 1: Check
```
┌─────────────────────────────────────┐
│  Check Target Server                │
│                                     │
│  First, we'll check if the target  │
│  server has all required software   │
│  installed.                         │
│                                     │
│  [Check Server]                     │
└─────────────────────────────────────┘
```

### Phase 2: Install
```
┌─────────────────────────────────────┐
│  Install Prerequisites              │
│                                     │
│  Missing components:                │
│  • Node.js 20+                      │
│  • PostgreSQL 16+                   │
│  • Redis                            │
│                                     │
│  ✓ Node.js - Installing...          │
│  ○ PostgreSQL - Pending             │
│  ○ Redis - Pending                  │
│                                     │
│  [Install Prerequisites]            │
└─────────────────────────────────────┘
```

### Phase 3: Ready
```
┌─────────────────────────────────────┐
│  ✅ Target Server Ready             │
│                                     │
│  All prerequisites are installed.   │
│  The server is ready for migration. │
│                                     │
│  [Start Migration]                  │
└─────────────────────────────────────┘
```

### Phase 4: Migrate
```
┌─────────────────────────────────────┐
│  Migrating Data                     │
│                                     │
│  users          1,234 / 1,234  ✓    │
│  conversations  5,678 / 5,678  ✓    │
│  messages       8,901 / 12,345 ▶    │
│  ███████░░░░░░░ 72%                 │
└─────────────────────────────────────┘
```

### Phase 5: Cutover
```
┌─────────────────────────────────────┐
│  ⚠️ Ready for Cutover               │
│                                     │
│  Migration is complete. Click       │
│  below to switch to the new server. │
│                                     │
│  ⚠️ This will suspend the old       │
│  server and make the new server     │
│  primary.                           │
│                                     │
│  [Perform Cutover]                  │
└─────────────────────────────────────┘
```

### Phase 6: Done
```
┌─────────────────────────────────────┐
│         ✅                          │
│  Migration Complete!                │
│                                     │
│  Your server has been successfully  │
│  migrated. You can now access       │
│  NeuroCore on the new server.       │
│                                     │
│  [Refresh Application]              │
└─────────────────────────────────────┘
```

---

## Troubleshooting

**Nothing happens when I click buttons**
- Check browser console for errors
- Verify route is registered in server

**Installation fails**
- Check internet connection (downloads required)
- Verify admin/sudo permissions
- Check available disk space

**Migration fails**
- Verify source database connection
- Check target database was created
- Look at server console for errors

---

## Files You Need

1. ✅ `migration-installer.ts` - Installs prerequisites
2. ✅ `migration-orchestrator.ts` - Coordinates workflow  
3. ✅ `migration-enhanced-routes.ts` - API endpoints
4. ✅ `MigrationWizard-Enhanced.tsx` - UI component

All provided in the output folder!

---

## Support

The system logs everything to console, so if something fails, you'll see exactly what went wrong and where.

Look for lines starting with:
- `[MIGRATION]` - General migration logs
- `[SystemAI-Stack]` - Stack system logs  
- `[Installation]` - Installation progress

---

**Ready to migrate? Just follow the 3 steps above and you're done!**
